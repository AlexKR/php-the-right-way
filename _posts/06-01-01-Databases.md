---
title: Бази даних
---

# Бази даних

Часто ваш PHP код буде використовувати базу даних для збереження інформації. У вас є кілька варіантів для підєднання та взаємодії з базою даних. Рекомендованим варіантом _до PHP 5.1.0_ було використання рідних драйверів, таких як [mysql][mysql], [mysqli][mysqli], [pgsql][pgsql], тощо.

Рідні драйвери чудові, якщо ви використовуєте ОДНУ базу даних в вашому додатку, та якщо, для прикладу, ви використовуєте MySQL та трошки MSSQL, або вам потрібно підключитися до бази даних Oracle, тоді ви не зможете використовувати ті ж драйвери. Вам буде потрібно вивчити нове API для кожної бази даних &mdash; і це може бути нерозумно.

В якості додаткової замітки про рідні драйвери, розширення MySQL для PHP більше не знаходиться в активній розробці і його офіційним статусом від PHP 5.4.0 являється "Застаріло через довгий час використання". Це означає він буде видалений на протязі наступних кількох релізів, отож в PHP 5.6 (або у всьому, що вийде після PHP 5.5) воно може пропасти. Якщо ви використовуєте `mysql_connect()` та `mysql_query()` у свому додатку, тоді вам прийдеться зіткнутися з переписуванням коду, отож найкращим варіантом буде замінити mysql використанням mysqli або PDO у своїх додатках під час вашого процесу розробки, отож би не стикнетеся з неробочим додатком потім. _Якщо ви починаєте з нуля тоді відмовтеся повністю від використання розширення mysql: використовуйте [Розширення MySQLi][mysqli], або PDO._

* [PHP: Вибір API для MySQL](http://php.net/manual/en/mysqlinfo.api.choosing.php)

## PDO

PDO це абстрактна бібліотека для підключення до бази даних &mdash; вбудована в PHP з версії 5.1.0 &mdash; вона забезпечує спільний інтерфейс для спілкування з великою кількістю різних баз даних. PDO не буде перекладати ваші SQL запити чи емулювати відсутні можливості; він чисто для підключення до різноманітних типів баз даних через одне і те ж API.

Більш важливо, що `PDO` дозволяє вам безпечно вводити дані користувача (напр. IDs) в ваші SQL запити без хвилювання щодо атак на SQL введення. Це можливо, завдяки використанню PDO виразів і звязування параметрів.

Припустиму, що PHP отримує числовий ID в якості параметру запиту. Цей ID повинен бути використаний для отримання запису користувача з бази даних. Ось `неправильний` шлях це зробити:

{% highlight php %}
<?php
$pdo = new PDO('sqlite:users.db');
$pdo->query("SELECT name FROM users WHERE id = " . $_GET['id']); // <-- NO!
{% endhighlight %}

Це жахливий код. Ви вставляєте сирі параметри в SQL запит. Це приведе до взламу вашого коду в секунди. Замість цього ви повинні очистити ввід ID використовуючи звязування параметрів PDO.

{% highlight php %}
<?php
$pdo = new PDO('sqlite:users.db');
$stmt = $pdo->prepare('SELECT name FROM users WHERE id = :id');
$stmt->bindParam(':id', $_GET['id'], PDO::PARAM_INT); //<-- Automatically sanitized by PDO
$stmt->execute();
{% endhighlight %}

Ось правильний код. Він використовує звязаний параметр в виразі PDO. Це дозволяє уникнути некоректного користувацького вводу ID перед тим як передати запит в базу даних, запобігаючи потенційні атаки типу SQL ін'єкцій.

* [Детальніше про PDO][1]

## Рівні абстракції

Багато фреймворків надають свій власний рівень абстракції, котрий може або не може сидіти поверх PDO. Вони часто будуть емулювати можливості для одної системи бази даних, котрі не має інша, повертаючи ваші запити в PHP методи, даючи вам фактичну абстракцію бази даних. Це звісно, добавить деякі накладні витрати, та якщо ви будуєте портативний додаток, якому потрібно працювати з MySQL, PostgreSQL та SQLite тоді мінімальними накладними витратами можна знехтувати задля чистоти коду.

Деякі рівні абстракції були побудовані з використанням PSR-0 стандарту простору імен, отож можуть бути встановлені в будь який додаток:

* [Doctrine2 DBAL][2]
* [ZF2 Db][4]
* [ZF1 Db][3]

[1]: http://www.php.net/manual/en/book.pdo.php
[2]: http://www.doctrine-project.org/projects/dbal.html
[3]: http://framework.zend.com/manual/en/zend.db.html
[4]: http://packages.zendframework.com/docs/latest/manual/en/index.html#zend-db

[mysql]: http://uk.php.net/mysql
[mysqli]: http://uk.php.net/mysqli
[pgsql]: http://uk.php.net/pgsql
